# Certificate configuration scenarios

Zowe's servers require a keystore for storage of the certificates used, and a truststore for validation of those certificates and any others encountered.
The keystore and truststore can be either unix file-based (PKCS12) or z/OS keyring-based, when on z/OS.
Regardless of storage type, The keystore and truststore can be automatically created by Zowe, populated either with certificates of your choosing or by having Zowe generate self-signed certificates for you.
This automation can be performed by defining and customizing the `zowe.setup.certificate` section of your Zowe YAML configuration.
Afterwards, Zowe can automate the certificate setup via the command `zwe init certificate`, which is also run as a subcommand of `zwe init`.

Continue reading to learn about the different scenarios for configuring Zowe for automatic certificate setup, and examples of each scenario.

Note:
You do not need to run the automation if you prefer not to. Given a keystore that contains a valid certificate* and its private key, and a truststore which validates it and any other certificates you expect to encounter,
Then you only need to correctly define `zowe.certificate` (not to be confused with `zowe.setup.certificate`) specifying the location of each object.

*A valid certificate for Zowe's use is one that either does not contain the "Extended Key Usage" section, or does but also includes the "Server" and "Client" authentication fields.


When configuring Zowe for certificates, think about which scenario suits you best:
* Will you be using file-based (PKCS12) certificates, or z/OS keyrings?
* Will you be letting Zowe create self-signed certificates, or will Zowe be using pre-made certificates you're providing?
* If you're providing certificates to Zowe and using a keyring, does the certificate already exist in your security database, or are you importing it via a dataset?

There are five scenarios/use cases for configuring certificates.
Use the applicable certificate configuration scenario according to your needs.
Each scenario listed below details configuration via code snippets that you need to use to edit your Zowe YAML configuration within the `zowe.setup.certificate` section.

* [Scenario 1: Use a file-based (PKCS12) keystore with Zowe generated certificates](#scenario-1-use-a-pkcs12-keystore-with-zowe-generated-certificates)
* [Scenario 2: Use a file-based (PKCS12) keystore and import a certificate generated by another CA](#scenario-2-use-a-pkcs12-keystore-and-import-a-certificate-generated-by-another-ca)
* [Scenario 3: Use a z/OS keyring-based keystore with Zowe generated certificates](#scenario-3-use-a-zos-keyring-with-zowe-generated-certificates)
* [Scenario 4: Use a z/OS keyring-based keystore and connect to an existing certificate](#scenario-4-use-a-zos-keyring-and-connect-to-an-existing-certificate)
* [Scenario 5: Use a z/OS keyring-based keystore and import a certificate stored in a data set](#scenario-5-use-a-zos-keyring-and-import-a-certificate-stored-in-a-data-set)

## Scenario 1: Use a file-based (PKCS12) keystore with Zowe generated certificates

1. Set the `type` of the certificate storage to `PKCS12`__

2. Customize the keystore directory in the following format:
    ```
    /var/zowe/keystore
    ```
3. Lock the keystore directory so it is accessible only to the Zowe runtime user and group:
    ```
    lock: true
    ```
4. Customize the certificate alias name. The default value is `localhost`.  
    **Note:** Use all lower case as an alias.
5. Set keystore password. Customizing this value is highly recommended. The default value is `password`.
6. Set the alias name of self-signed certificate authority. The default value is `local_ca`.  
   **Note:** Use all lower case as an alias.
   ```
   caAlias: local_ca
   ```
7. Set the password of the keystore stored self-signed certificate authority. The default value is `local_ca_password`.
    ```
    caPassword: local_ca_password
    ```
8. (Optional) Specify the distinguished name for Zowe generated certificates. 

    ```
    dname:
      caCommonName: ""
      commonName: ""
      orgUnit: ""
      org: ""
      locality: ""
      state: ""
      country: ""
    ```
9. Set the validity in days for the Zowe generated certificates
    ```  
    validity: 3650
    ```
10. Set the domain names and IPs specified in nested subsection `SAN`. If this field is not defined, the `zwe init` command uses the value `zowe.externalDomains`.
    ```
    san:
        sample domain name
        - dvipa.my-company.com
        sample IP address
        - 12.34.56.78
     ```

  **Example zowe yaml for scenario 1**  
  
**_ADD EXAMPLE_**

## Scenario 2: Use a file-based (PKCS12) keystore and import a certificate generated by another CA

1. Set the `type` of the certificate storage to `PKCS12`__

2. Customize the keystore directory in the following format:
    ```
    /var/zowe/keystore
    ```
3. Lock the keystore directory so it is accessible only to the Zowe runtime user and group:
    ```
    lock: true
    ```
4. Customize the certificate alias name. The default value is `localhost`.  
    **Note:** Use all lower case as an alias.
5. Set keystore password. The default value is `password`.
6. Set the existing PKCS12 keystore which holds the certificate issued by an external CA.  
    ```
    keystore: ""  
    ```
7. Set the password of the keystore set in step 6.  
    ```
    password: ""
    ```
8. Specify the alias of the certificate to be imported.
    ```
    alias: ""
    ```  
    **Note:** Use all lower cases as an alias.    
    
9. Set the path to the certificate authority that signed the certificate to be imported.
    ```
    importCertificateAuthorities:
    ```
    **Note:** PEM format certificate authorities can be imported and trusted.

  **Example zowe yaml for scenario 2**  
  
**_ADD EXAMPLE_**

##  Scenario 3: Use a z/OS keyring-based keystore with Zowe generated certificates

1. Set the `type` of the certificate storage to one of the following keyring types:__

    * JCEKS  
    * JCECCAKS  
    * JCERACFKS  
    * JCECCARACFKS  
    * JCEHYBRIDRACFKS

2. Add the parameter `createZosmfTrust` and set to true.  
    ```
    createZosmfTrust: true
    ```
3. Under the nested subsection `keyring:`, specify the following keyring values:  

    * keyring name  
        ```
        name: ZoweKeyring
        ```
    * Label of Zowe certificate. The default value is `localhost`.  
        ```
        label: localhost
        ```
    * Label of Zowe CA certificate. The default value is `localca`.
        ```
        caLabel: localca
        ```
    * The distinguished name for Zowe generated certificates.  
        ```
        dname:
            caCommonName: ""
            commonName: ""
            orgUnit: ""
            org: ""
            locality: ""
            state: ""
            country: ""
        ```
4. Set the validity in days for the Zowe generated certificates
    ```  
    validity: 3650
    ```
5. Set the domain names and IPs specified in the certificate SAN. If 
this field is not defined, the `zwe init` command uses the value `zowe.externalDomains`.  
    ```
    san:
      - dvipa.my-company.com
      - 12.34.56.78
    ```
    **Note**: Due to the limitation of the `RACDCERT` command, this field should contain exactly 2 entries with the domain name and IP address.

  **Example zowe yaml for scenario 3**  
  
**_ADD EXAMPLE_**

## Scenario 4: Use a z/OS keyring-based keystore and connect to an existing certificate

1. Set the `type` of the certificate storage to one of the following keyring types:__

    * JCEKS  
    * JCECCAKS  
    * JCERACFKS  
    * JCECCARACFKS  
    * JCEHYBRIDRACFKS

2. Under `keyring:`, specify the keyring name:  
    ```
    name: ZoweKeyring
    ```
3. Under the nested subsection `connect:`, specify the following parameters:  
    * The current owner of the certificate. Possible values can be `SITE` or a user ID.
        ```
        user: IBMUSER
        ```
    * The label of the existing certificate to be connected to the Zowe keyring.  
        ```
        label: ""
        ```
    * All certificate authorities you want to be trusted in the Zowe keyring.
        ```
        importCertificateAuthorities:
          - ""
        ```
        **Note:** Due to the limitation of `RACDCERT` command, this field should contain a maximum of 2 entries.  

  **Example zowe yaml for scenario 4**  
  
**_ADD EXAMPLE_**

## Scenario 5: Use a z/OS keyring-based keystore and import a certificate stored in a data set

1. Set the `type` of the certificate storage to one of the following keyring types:__

    * JCEKS  
    * JCECCAKS  
    * JCERACFKS  
    * JCECCARACFKS  
    * JCEHYBRIDRACFKS

2. Under `keyring:`, specify the following keyring values:  

    * keyring name  
        ```
        name: ZoweKeyring
        ```
    * Label of Zowe certificate. The default value is `localhost`.  
        ```
        label: localhost
        ```
3. Under the nested subsection `import:` specify the following parameters:
    * The name of the data set holds the certificate issued by another CA. This data set should be in PKCS12 format and contain private key.
        ```
        dsName: ""
        ```
    * The password for the PKS12 data set.
        ```
        password: ""
        ```
  **Example zowe yaml for scenario 5**  

**_ADD EXAMPLE_**      
