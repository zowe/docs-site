# Import and configure a certificate if you have one

One option for using certificates in Zowe is to import and configure existing certificates. Zowe supports the following types of certificates for import:

* File-based [PKCS12 certificates](#import-an-existing-pkcs12-certificate)
* [JCERACFKS certificates](#import-an-existing-jceracfks-certificate)

Review the procedure to import existing PKCS12 or JCERACFKS certificates as well as how to import a certificate stored in an MVS data set into a Zowe key ring.

## Import an existing PKCS12 certificate

To import a PKCS12 certificate, it is first necessary to import a certificate authority. Then, you can configure the zowe.yaml according to [Scenario 2: Use a file-based (PKCS12) keystore and import a certificate generated by another CA](#certificate-configuration-scenarios.md/#scenario-2-use-a-pkcs12-keystore-and-import-a-certificate-generated-by-another-ca) described in the article Certificate configuration scenarios.

For PKCS12 certificate users, specify the following parameters in the `zowe.yaml` file:

| Parameter | Description |
| --------- | ------------|
| `zowe.setup.certificate.pkcs12.import.keystore` | Define it if you acquired one or more certificates from another CA, stored them in PKCS12 format, and now want to import the certificate(s) into the Zowe PKCS12 keystore.
| `zowe.setup.certificate.pkcs12.import.password` | Specify it. This value is the password for keystore defined in `zowe.setup.certificate.pkcs12.import.keystore`. |
| `zowe.setup.certificate.pkcs12.import.alias` | Specify it. This value is the original certificate alias defined in `zowe.setup.certificate.pkcs12.import.keystore`. |
| `zowe.setup.certificate.pkcs12.name`| The imported certificate is saved under the alias specified in it. |

**Configure `zowe.yaml`:**
```
zowe:
  setup:
    certificate:
      type: PKCS12
      pkcs12:
        directory: /var/zowe/keystore
        lock: true
          name: localhost     # Optional, default value is localhost.
          password: password  # Optional, default value is password.
        import:
          keystore: ""
          password: ""
          alias: ""
      importCertificateAuthorities:
        - ""
```

**Note:**  
Due to the limitation of the `RACDCERT` command, the `importCertificateAuthorities` field can contain a maximum of two entries.

### Manually import a certificate authority into a web browser

To avoid the browser untrusted CA challenge, import Zowe's certificates into the browser.

Trust in the API ML server is a necessary precondition for secure communication between the browser or API Client application. Ensure this trust by installing a Certificate Authority (CA) public certificate. By default, API ML creates a local CA. Import the CA public certificate to the truststore for REST API clients and to your browser. You can also import the certificate to your root certificate store.

<!-- - If a SAF keyring is being used and set up with `ZWEKRING` JCL, the procedure to obtain the certificate does not apply. It is recommended that you work with your security system administrator to obtain the certificate. Start the procedure at step 2. -->

The public certificate in [PEM format](https://en.wikipedia.org/wiki/Privacy-Enhanced_Mail) is stored at `<KEYSTORE_DIRECTORY>/local_ca/localca.cer` where `<KEYSTORE_DIRECTORY>` is defined in a customized `<RUNTIME_DIR>/bin/zowe-setup-certificates.env` file during the installation step that generates Zowe certificates. The certificate is stored in UTF-8 encoding so you need to transfer it as a binary file. Since this is the certificate to be trusted by your browser, it is recommended to use a secure connection for transfer.

**Note:**  
Windows currently does not recognize the PEM format. For Windows, use the P12 version of the `local_cer`.

**Procedure:**

To import the certificate to your root certificate store and trust it, follow the applicable procedure based on your operating system.

  - **For Windows**, run the following command:

    ```
    certutil -enterprise -f -v -AddStore "Root" localca.cer
    ```

    **Note:** Ensure that you open the terminal as **administrator**. This operation installs the certificate to the Trusted Root Certification Authorities.

  - **For macOS**, run the following command:  
    
    ```
    $ sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain localca.cer
    ```

  - **For Firefox**, manually import your root certificate via the Firefox settings, or force Firefox to use the Windows truststore.
    As a default, Firefox uses its own certificate truststore.

    Create a new Javascript file firefox-windows-truststore.js at `C:\Program Files (x86)\Mozilla Firefox\defaults\pref` with the   following content:

    ```
    /* Enable experimental Windows truststore support */
    pref("security.enterprise_roots.enabled", true);
    ```

**Tips:**  
To avoid requiring each browser to trust the CA that signed the Zowe certificate, you can use a public certificate authority to create a certificate. Optional public certificate authorities include _Symantec_, _Comodo_, _Let's Encrypt_, or _GoDaddy_.  Certificates generated by such public CAs are trusted by all browsers and most REST API clients. This option, however, requires a manual process to request a certificate and may incur a cost payable to the publicly trusted CA.

### Import a local CA certificate on Linux

Zowe also supports importing certificates to make REST HTTPS curl request from the command line.

Follow these steps to import `local_ca.cer` from the path `.../zowe/keystore/local_ca`.

**Note:** Steps are verified with Ubuntu 20.04.6 LTS.

1. Rename `local_ca.cer` with `local_ca.crt` and copy it to the shared ca-certificates path.
   
   `$ cp local_ca.cer /usr/local/share/ca-certificates/zowe_local_ca.crt`

2. Execute a ca-certificate store update by running the following command:
   
   `$ sudo update-ca-certificates`

3. Verify that the new expected certificate was added (the newest will be at the bottom of the list which contains an extended list of concatenated CAs)
   
   `$ cat /etc/ssl/certs/ca-certificates.crt`

4. Run a basic curl HTTPS request from the command line. For example, run the following command:

  ```
    curl --request 'GET'
  --url 'https://tvt6092.svl.ibm.com:7554/jobs/api/v1?owner=ibmuser&prefix=*'
  --header 'Authorization: Basic ************'
  ```

## Import an existing JCERACFKS certificate

To import a JCERACFKS certificate, use the example yaml according to [Scenario 4: Use a z/OS keyring-based keystore and connect to an existing certificate](#certificate-configuration-scenarios.md/#scenario-4-use-a-zos-keyring-and-connect-to-an-existing-certificate) in the article Certificate configuration scenarios.

To use a JCERACFKS certificate, specify the following parameters in the `zowe.yaml` file:

| Parameter | Description |
| --------- | ------------|
| `zowe.setup.certificate.keyring.connect.user` | This is a required parameter that specifies the owner of existing certificate. This field can have value of SITE or a user ID.|
| `zowe.setup.certificate.keyring.connect.label` | This is a required parameter that sets the label of an existing certificate. |

To import an existing JCERACFKS certificate, you need to identify the certificate and create a key ring for it to connect.

* **Step 1**: Identify the existing certificate that you want to use. For example, if you want to use the certificate that your LPAR is using, run the TSO command `zowe tso issue command "RACDCERT LISTRING(*) ID(IZUSVR)" --ssm` to check it.

* **Step 2**: Create a key ring that connects to this certificate and its certificate authority by uncommenting the **scenario 4** and updating the four fields:
  * `zowe.setup.certificate.type:` to be `JCERACFKS`
  * `zowe.setup.certificate.keyring.name:` to be the name of the key ring that we want to generate, for example, `ZoweKeyring`
  * `zowe.setup.certificate.keyring.connect.label:` to point to the existing certificate's owner of the user, for example, `IBMUSER`
  * `zowe.setup.certificate.importCertificateAuthorities:` to be to be the certificate signing authorities (CAs) for this certificate, for example, `ZoweCA`

**Configure `zowe.yaml`:**
```
zowe:
  setup:
    certificate:
      type: JCERACFKS
      keyring:
        name: ZoweKeyring
        connect:
          user: IBMUSER
          label: ""
      importCertificateAuthorities:
        - "ZoweCA"
```

**Note:**  
Due to the limitation of the RACDCERT command, the `importCertificateAuthorities` field can contain a maximum of two entries.

## Import a certificate stored in an MVS data set into a Zowe key ring

To import a certificate that is stored in a data set into a key ring, configure the zowe.yaml according to the example yaml in [Scenario 5: Use a z/OS keyring-based keystore and import a certificate stored in a data set](#certificate-configuration-scenarios/#scenario-5-use-a-zos-keyring-and-import-a-certificate-stored-in-a-data-set)

 To use a JCERACFKS certificate, specify the following parameters in the `zowe.yaml` file.

| Parameter | Description |
| --------- | ----------- |
|`zowe.setup.certificate.keyring.connect.dsName` | This is a required parameter which specifies the data set where the certificate stored.|
|`zowe.setup.certificate.keyring.connect.password` | This parameter specifies the password when importing the certificate. |
| `zowe.setup.certificate.keyring.label`  | This parameter specifies that label of the certificate that is imported. |

**Configure `zowe.yaml`:**
```
zowe:
  setup:
    certificate:
      type: JCERACFKS
      keyring:
        name: ZoweKeyring
        label: localhost  # Optional, default value is localhost.
      import:
        dsName: ""
        password: ""
```

<!-- Any command to run? -->

## Next steps

Once your certiicate is successfully imported, review the documentation about [how to use these certificates](./use-certificates.md) in a Zowe production environement.
